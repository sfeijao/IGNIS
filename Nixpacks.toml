# Explicit Nixpacks config to control build and caching

# Fix: Force clean install to ensure all devDependencies are installed
# Railway was caching old node_modules with only 46 packages instead of 167

[phases.setup]
# no-op: rely on default Node detection

[phases.install]
cmd = "npm ci"

[phases.build]
# Clean install dashboard/next dependencies with --legacy-peer-deps to avoid conflicts
cmd = "npm install --no-audit --no-fund && cd dashboard/next && rm -rf node_modules && npm ci --legacy-peer-deps && npm run build"

[phases.start]
cmd = "npm start"

[caches]
# Disable node_modules caching to force fresh install
paths = []

