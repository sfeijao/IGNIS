(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[550],{4195:function(e,t,l){Promise.resolve().then(l.bind(l,4311)),Promise.resolve().then(l.bind(l,912)),Promise.resolve().then(l.bind(l,1481))},4311:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return d}});var r=l(7437),a=l(2265),s=l(9988),n=l(2837),o=l(8183),i=l(7814);function d(){let e=(0,n._)(),{toast:t}=(0,o.p)(),{t:l,lang:d,setLang:c}=(0,i.QT)(),[u,m]=(0,a.useState)([]),[x,h]=(0,a.useState)("novo-cargo"),[p,b]=(0,a.useState)(""),[f,g]=(0,a.useState)(!1),[v,y]=(0,a.useState)(null),[j,w]=(0,a.useState)(null),[N,k]=(0,a.useState)(null),[C,S]=(0,a.useState)(null),[P,E]=(0,a.useState)(null),[T,_]=(0,a.useState)(null),[R,z]=(0,a.useState)(new Set),[D,M]=(0,a.useState)(""),O=async()=>{if(e){g(!0),y(null);try{let t=await s.h.getRoles(e);m(t.roles||[])}catch(e){y((null==e?void 0:e.message)||l("roles.load.failed"))}finally{g(!1)}}};(0,a.useEffect)(()=>{O()},[e]),(0,a.useEffect)(()=>{if(!e||!P){_(null),z(new Set);return}let r=!1;return(async()=>{try{let t=await s.h.getRole(e,P);if(r)return;let l=t.role;if(_(l),l.permissions)try{let e=BigInt(l.permissions),t=new Set;for(let{key:l}of i.S4){let r=i.Dl[l];r&&(e&r)===r&&t.add(l)}z(t)}catch(e){z(new Set)}else z(new Set)}catch(e){t({type:"error",title:l("roles.role.load.failed"),description:null==e?void 0:e.message})}})(),()=>{r=!0}},[e,P]);let L=async()=>{if(e){g(!0);try{await fetch("/api/guild/".concat(e,"/roles"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:x,color:p,hoist:!1,mentionable:!1})}),await O()}finally{g(!1)}}},B=async t=>{if(e&&confirm(l("roles.remove.confirm"))){g(!0);try{await fetch("/api/guild/".concat(e,"/roles/").concat(t),{method:"DELETE",credentials:"include"}),await O()}finally{g(!1)}}},F=async(t,l)=>{if(e){g(!0);try{await s.h.moveRole(e,t,{direction:l,delta:1}),await O()}finally{g(!1)}}},I=e=>{w(e)},V=()=>{w(null),k(null),S(null)},A=(e,t)=>{if(e.preventDefault(),!j)return;let l=e.currentTarget.getBoundingClientRect(),r=e.clientY-l.top<l.height/2?"above":"below";k(t),S(r)},H=async r=>{if(!e||!j||j===r)return;let a=u.findIndex(e=>e.id===j),n=u.findIndex(e=>e.id===r);if("below"===C&&(n+=1),a<0||n<0)return;let o=n<a?"up":"down",i=Math.abs(n-a);g(!0);try{await s.h.moveRole(e,j,{direction:o,delta:i}),await O()}catch(e){t({type:"error",title:l("roles.move.failed"),description:null==e?void 0:e.message})}finally{g(!1),V()}},q=e=>{z(t=>{let l=new Set(t);return l.has(e)?l.delete(e):l.add(e),l})},G=async()=>{if(e&&P&&T){g(!0);try{let l={name:T.name,color:T.color,hoist:!!T.hoist,mentionable:!!T.mentionable};R.size>0&&(l.permissions=Array.from(R)),await s.h.updateRole(e,P,l),t({type:"success",title:"Cargo atualizado"}),await O()}catch(e){t({type:"error",title:"Falha ao atualizar cargo",description:null==e?void 0:e.message})}finally{g(!1)}}};return(0,r.jsxs)("div",{className:"space-y-3",children:[!e&&(0,r.jsx)("div",{className:"card p-4 text-sm text-neutral-400",children:l("roles.selectGuild")}),(0,r.jsxs)("div",{className:"card p-4 flex flex-wrap items-end gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"role-name",className:"text-xs text-neutral-400",children:l("roles.name")}),(0,r.jsx)("input",{id:"role-name",className:"mt-1 w-48 bg-neutral-900 border border-neutral-700 rounded px-2 py-1",value:x,onChange:e=>h(e.target.value),placeholder:l("roles.name"),title:l("roles.name")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"role-color",className:"text-xs text-neutral-400",children:l("roles.color")}),(0,r.jsx)("input",{id:"role-color",className:"mt-1 w-40 bg-neutral-900 border border-neutral-700 rounded px-2 py-1",value:p,onChange:e=>b(e.target.value),placeholder:"#ffffff",title:l("roles.color")})]}),(0,r.jsx)("button",{onClick:L,className:"mt-5 px-3 py-2 rounded bg-brand-600 hover:bg-brand-700 disabled:opacity-50",disabled:!e||f,children:l("roles.create")}),(0,r.jsx)("button",{onClick:O,className:"mt-5 px-3 py-2 rounded bg-neutral-800 border border-neutral-700 hover:bg-neutral-700 disabled:opacity-50",disabled:!e||f,children:l("roles.refresh")}),(0,r.jsxs)("div",{className:"ml-auto flex items-end gap-2",children:[(0,r.jsx)("label",{className:"text-xs text-neutral-400",children:"Lang"}),(0,r.jsxs)("select",{className:"mt-5 bg-neutral-900 border border-neutral-700 rounded px-2 py-2 text-sm",value:d,onChange:e=>c(e.target.value),"aria-label":"Language",children:[(0,r.jsx)("option",{value:"pt",children:"PT"}),(0,r.jsx)("option",{value:"en",children:"EN"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[(0,r.jsx)("div",{className:"card p-0 overflow-hidden",children:(0,r.jsxs)("div",{className:"divide-y divide-neutral-800",children:[f&&(0,r.jsx)("div",{className:"p-6 text-neutral-400",children:l("roles.loading")}),v&&(0,r.jsx)("div",{className:"p-6 text-red-400",children:v}),u.map(e=>(0,r.jsxs)("div",{onDragOver:t=>A(t,e.id),onDrop:()=>H(e.id),className:"relative p-4 flex items-center gap-3 ".concat(P===e.id?"bg-neutral-800/40":""),onClick:()=>E(e.id),children:[N===e.id&&"above"===C&&(0,r.jsx)("div",{className:"absolute left-0 right-0 top-0 h-0.5 bg-brand-600"}),N===e.id&&"below"===C&&(0,r.jsx)("div",{className:"absolute left-0 right-0 bottom-0 h-0.5 bg-brand-600"}),(0,r.jsx)("button",{className:"cursor-grab p-1 rounded hover:bg-neutral-800 border border-transparent hover:border-neutral-700",draggable:!0,onDragStart:()=>I(e.id),onDragEnd:V,onClick:e=>e.stopPropagation(),"aria-label":"Drag to reorder",title:"Drag to reorder",children:(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M4 3h2v2H4V3zm6 0h2v2h-2V3zM4 7h2v2H4V7zm6 0h2v2h-2V7zM4 11h2v2H4v-2zm6 0h2v2h-2v-2z",fill:"#aaa"})})}),(0,r.jsx)("div",{className:"h-4 w-4 rounded role-color-dot",style:{"--role-color":e.color||"#888"}}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"text-neutral-200 truncate",children:e.name}),(0,r.jsx)("div",{className:"text-xs text-neutral-500",children:e.id})]}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),F(e.id,"up")},"aria-label":"".concat(l("roles.up")," ").concat(e.name),title:l("roles.up"),className:"px-2 py-1 text-xs rounded bg-neutral-800 border border-neutral-700 hover:bg-neutral-700",children:l("roles.up")}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),F(e.id,"down")},"aria-label":"".concat(l("roles.down")," ").concat(e.name),title:l("roles.down"),className:"px-2 py-1 text-xs rounded bg-neutral-800 border border-neutral-700 hover:bg-neutral-700",children:l("roles.down")}),!e.managed&&(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),B(e.id)},"aria-label":"".concat(l("roles.remove")," ").concat(e.name),title:l("roles.remove"),className:"px-2 py-1 text-xs rounded bg-rose-600 hover:bg-rose-500",children:l("roles.remove")})]},e.id))]})}),(0,r.jsxs)("div",{className:"card p-4",children:[!P&&(0,r.jsx)("div",{className:"text-sm text-neutral-400",children:l("roles.selectToEdit")}),P&&T&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs text-neutral-400",children:l("roles.name")}),(0,r.jsx)("input",{className:"mt-1 w-full bg-neutral-900 border border-neutral-700 rounded px-2 py-1",value:T.name||"",onChange:e=>_({...T,name:e.target.value}),placeholder:l("roles.name"),title:l("roles.name")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-xs text-neutral-400",children:l("roles.color")}),(0,r.jsx)("input",{className:"mt-1 w-full bg-neutral-900 border border-neutral-700 rounded px-2 py-1",value:T.color||"",onChange:e=>_({...T,color:e.target.value}),placeholder:"#ffffff",title:l("roles.color")})]}),(0,r.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm",children:[(0,r.jsx)("input",{type:"checkbox",checked:!!T.hoist,onChange:e=>_({...T,hoist:e.target.checked})})," ",l("roles.showSeparately")]}),(0,r.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm",children:[(0,r.jsx)("input",{type:"checkbox",checked:!!T.mentionable,onChange:e=>_({...T,mentionable:e.target.checked})})," ",l("roles.mentionable")]})]}),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:l("roles.permissions")}),(0,r.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded bg-neutral-800 border border-neutral-700 hover:bg-neutral-700",onClick:()=>z(new Set(i.S4.map(e=>e.key))),children:l("roles.permissions.selectAll")}),(0,r.jsx)("button",{className:"px-2 py-1 text-xs rounded bg-neutral-800 border border-neutral-700 hover:bg-neutral-700",onClick:()=>z(new Set),children:l("roles.permissions.clearAll")})]})]}),(0,r.jsx)("input",{className:"mb-2 w-full bg-neutral-900 border border-neutral-700 rounded px-2 py-1",placeholder:l("roles.permissions.search"),value:D,onChange:e=>M(e.target.value),"aria-label":l("roles.permissions.search")}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-60 overflow-auto pr-1",children:i.S4.filter(e=>{if(!D)return!0;let t=D.toLowerCase();return(l("perm.".concat(e.key))||e.key).toLowerCase().includes(t)||e.key.toLowerCase().includes(t)}).map(e=>(0,r.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm ".concat(e.danger?"text-amber-300":""),title:e.key,children:[(0,r.jsx)("input",{type:"checkbox",checked:R.has(e.key),onChange:()=>q(e.key)})," ",l("perm.".concat(e.key))]},e.key))}),(0,r.jsx)("div",{className:"text-xs text-neutral-500 mt-2",children:l("roles.permissions.note")})]}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)("button",{onClick:G,className:"px-3 py-2 rounded bg-neutral-800 border border-neutral-700 hover:bg-neutral-700",disabled:f,children:l("roles.save")})})]})]})]})]})}},8183:function(e,t,l){"use strict";l.d(t,{ToasterProvider:function(){return o},p:function(){return n}});var r=l(7437),a=l(2265);let s=(0,a.createContext)(null);function n(){let e=(0,a.useContext)(s);if(!e)throw Error("useToast must be used within <ToasterProvider />");return e}function o(e){let{children:t}=e,[l,n]=(0,a.useState)([]),o=(0,a.useRef)(0),i=(0,a.useCallback)(e=>{n(t=>t.filter(t=>t.id!==e))},[]),d=(0,a.useCallback)(e=>{let t="".concat(Date.now(),"_").concat(o.current++),l={id:t,...e};n(e=>[...e,l]),window.setTimeout(()=>i(t),4500)},[i]),c=(0,a.useMemo)(()=>({toast:d}),[d]);return(0,r.jsxs)(s.Provider,{value:c,children:[t,(0,r.jsx)("div",{className:"fixed z-50 right-4 bottom-4 flex flex-col gap-2 w-[min(92vw,380px)]",role:"status","aria-live":"polite",children:l.map(e=>(0,r.jsxs)("div",{className:"rounded-xl border p-3 shadow-lg backdrop-blur card ".concat("success"===e.type?"border-emerald-700/60":"error"===e.type?"border-rose-700/60":"border-neutral-700/60"),children:[e.title&&(0,r.jsx)("div",{className:"text-sm font-semibold mb-0.5",children:e.title}),e.description&&(0,r.jsx)("div",{className:"text-xs text-neutral-300",children:e.description})]},e.id))})]})}},912:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return a}});let r=l(5592);function a(e){let{reason:t,children:l}=e;if("undefined"==typeof window)throw new r.BailoutToCSRError(t);return l}},1481:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return s}});let r=l(7437),a=l(8512);function s(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let l=(0,a.getExpectedRequestStore)("next/dynamic css"),s=[];if(l.reactLoadableManifest&&t){let e=l.reactLoadableManifest;for(let l of t){if(!e[l])continue;let t=e[l].files.filter(e=>e.endsWith(".css"));s.push(...t)}}return 0===s.length?null:(0,r.jsx)(r.Fragment,{children:s.map(e=>(0,r.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:l.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}}},function(e){e.O(0,[814,482,971,23,744],function(){return e(e.s=4195)}),_N_E=e.O()}]);