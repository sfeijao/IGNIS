(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[922],{2728:function(e,a,t){Promise.resolve().then(t.bind(t,3842))},3842:function(e,a,t){"use strict";t.d(a,{default:function(){return o}});var l=t(7437),s=t(2265),n=t(2837),i=t(9988),c=t(7814);function o(){let[e,a]=(0,s.useState)(null),[t,o]=(0,s.useState)({}),[d,u]=(0,s.useState)(""),[h,m]=(0,s.useState)(!1),[f,p]=(0,s.useState)(null),[v,g]=(0,s.useState)(!1),{t:x}=(0,c.QT)(),[b,y]=(0,s.useState)([]),[C,j]=(0,s.useState)([]),[k,N]=(0,s.useState)([]),[S,w]=(0,s.useState)([]),[I,L]=(0,s.useState)(""),[_,E]=(0,s.useState)(""),[O,q]=(0,s.useState)(""),[Q,J]=(0,s.useState)(""),[M,W]=(0,s.useState)("");(0,s.useEffect)(()=>{a((0,n._)())},[]),(0,s.useEffect)(()=>{(async()=>{if(e){m(!0),p(null),g(!1);try{let a=await i.h.getTicketsConfig(e),t=(null==a?void 0:a.config)||a||{};o(t),u(JSON.stringify(t,null,2));let[l,s,n,c]=await Promise.allSettled([i.h.getRoles(e),i.h.getChannels(e),i.h.getCategories(e),i.h.getWebhooks(e)]);if("fulfilled"===l.status&&y(l.value.roles||l.value||[]),"fulfilled"===s.status&&j((s.value.channels||s.value||[]).filter(e=>e&&e.id&&e.name)),"fulfilled"===n.status&&N(n.value.categories||n.value||[]),"fulfilled"===c.status){let e=(c.value.webhooks||c.value||[]).map(e=>({id:String(e._id||e.id||"".concat(e.type,":").concat(e.channel_id||"")),name:e.name,type:e.type,url:e.url}));w(e)}}catch(e){p((null==e?void 0:e.message)||x("common.saveFailed"))}finally{m(!1)}}})()},[e]);let R=async()=>{if(e){m(!0),p(null),g(!1);try{let a=t;try{a=JSON.parse(d)}catch(e){}let l=await i.h.saveTicketsConfig(e,a),s=(null==l?void 0:l.config)||a;o(s),u(JSON.stringify(s,null,2)),g(!0)}catch(e){p((null==e?void 0:e.message)||"Erro ao salvar config")}finally{m(!1)}}};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold",children:x("tickets.config.title")}),(0,l.jsx)("button",{onClick:()=>e&&a(e),className:"btn btn-secondary",title:x("tickets.reload"),children:x("tickets.reload")})]}),f&&(0,l.jsx)("div",{className:"text-red-400",children:f}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsxs)("section",{className:"card",children:[(0,l.jsx)("div",{className:"card-header",children:x("tickets.fields.common")}),(0,l.jsxs)("div",{className:"card-body grid grid-cols-1 gap-3",children:[(0,l.jsx)(r,{label:x("tickets.panelChannelId"),value:t.panelChannelId||"",onChange:e=>o(a=>({...a,panelChannelId:e})),query:_,setQuery:E,options:(0,s.useMemo)(()=>C.filter(e=>e.name.toLowerCase().includes(_.toLowerCase())).map(e=>({value:e.id,label:e.name})),[C,_]),placeholder:"—"}),(0,l.jsx)(r,{label:x("tickets.staffRoleId"),value:t.staffRoleId||"",onChange:e=>o(a=>({...a,staffRoleId:e})),query:I,setQuery:L,options:(0,s.useMemo)(()=>b.filter(e=>e.name.toLowerCase().includes(I.toLowerCase())).map(e=>({value:e.id,label:e.name})),[b,I]),placeholder:"—"}),(0,l.jsx)(r,{label:x("tickets.archiveCategoryId"),value:t.archiveCategoryId||"",onChange:e=>o(a=>({...a,archiveCategoryId:e})),query:O,setQuery:q,options:(0,s.useMemo)(()=>k.filter(e=>e.name.toLowerCase().includes(O.toLowerCase())).map(e=>({value:e.id,label:e.name})),[k,O]),placeholder:"—"}),(0,l.jsx)(r,{label:x("tickets.logChannelId"),value:t.logChannelId||"",onChange:e=>o(a=>({...a,logChannelId:e})),query:Q,setQuery:J,options:(0,s.useMemo)(()=>C.filter(e=>e.name.toLowerCase().includes(Q.toLowerCase())).map(e=>({value:e.id,label:e.name})),[C,Q]),placeholder:"—"}),(0,l.jsx)(r,{label:x("tickets.transcriptWebhook"),value:t.transcriptWebhook||"",onChange:e=>o(a=>({...a,transcriptWebhook:e})),query:M,setQuery:W,options:(0,s.useMemo)(()=>S.filter(e=>(e.name||e.type||e.url||"").toLowerCase().includes(M.toLowerCase())).map(e=>({value:e.url||"",label:"".concat(e.name||"Webhook").concat(e.type?" (".concat(e.type,")"):"")})),[S,M]),placeholder:"—"}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("label",{className:"text-sm opacity-80",children:x("tickets.enabled")}),(0,l.jsx)("input",{type:"checkbox",checked:!!t.enabled,onChange:e=>o(a=>({...a,enabled:e.target.checked})),title:x("tickets.enabled")})]}),(0,l.jsx)("button",{className:"btn btn-primary w-fit",onClick:R,disabled:h,children:x("common.save")}),v&&(0,l.jsx)("span",{className:"text-green-400",children:x("tickets.saved")})]})]}),(0,l.jsxs)("section",{className:"card",children:[(0,l.jsx)("div",{className:"card-header",children:x("tickets.json.editor")}),(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsx)("textarea",{className:"input min-h-[280px] font-mono",value:d,onChange:e=>u(e.target.value),title:"Editor JSON"}),(0,l.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>u(JSON.stringify(t,null,2)),children:x("tickets.json.revert")}),(0,l.jsx)("button",{className:"btn btn-primary",onClick:R,disabled:h,children:x("tickets.json.save")})]})]})]})]})]})}function r(e){let{label:a,value:t,onChange:s,options:n,query:i,setQuery:c,placeholder:o}=e;return(0,l.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{className:"text-sm opacity-80",children:a}),(0,l.jsx)("input",{className:"input",value:i,onChange:e=>c(e.target.value),placeholder:"Pesquisar…",title:a+" search"}),(0,l.jsxs)("select",{className:"input",value:t,onChange:e=>s(e.target.value),title:a,children:[(0,l.jsx)("option",{value:"",children:o||"—"}),n.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))]})]})}}},function(e){e.O(0,[814,482,971,23,744],function(){return e(e.s=2728)}),_N_E=e.O()}]);