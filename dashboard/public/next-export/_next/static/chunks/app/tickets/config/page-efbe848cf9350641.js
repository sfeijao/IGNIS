(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[922],{2728:function(e,t,a){Promise.resolve().then(a.bind(a,3842))},3842:function(e,t,a){"use strict";a.d(t,{default:function(){return u}});var s=a(7437),l=a(2265),n=a(2837),i=a(9988),c=a(7814),o=a(8183);let r=e=>{var t;let a=(null!==(t=null==e?void 0:e.type)&&void 0!==t?t:"").toString().toLowerCase();return""===a||"0"===a||"text"===a||"guild_text"===a||"5"===a||"announcement"===a||"guild_announcement"===a},d=e=>{var t;let a=(null!==(t=null==e?void 0:e.type)&&void 0!==t?t:"").toString().toLowerCase();return"0"===a||"text"===a||"guild_text"===a?"Text":"2"===a||"voice"===a||"guild_voice"===a?"Voice":"4"===a||"category"===a||"guild_category"===a?"Category":"5"===a||"announcement"===a||"guild_announcement"===a?"Announcement":"Channel"};function u(){let[e,t]=(0,l.useState)(null),[a,u]=(0,l.useState)({}),[h,v]=(0,l.useState)(""),[f,x]=(0,l.useState)(!1),[g,p]=(0,l.useState)(null),[k,b]=(0,l.useState)(!1),{t:C}=(0,c.QT)(),{toast:y}=(0,o.p)(),[j,N]=(0,l.useState)([]),[I,w]=(0,l.useState)([]),[S,_]=(0,l.useState)([]),[L,R]=(0,l.useState)([]),[T,q]=(0,l.useState)(""),[E,M]=(0,l.useState)(""),[O,P]=(0,l.useState)(""),[J,Q]=(0,l.useState)(""),[F,W]=(0,l.useState)("");(0,l.useEffect)(()=>{t((0,n._)())},[]),(0,l.useEffect)(()=>{(async()=>{if(e){x(!0),p(null),b(!1);try{let t=await i.h.getTicketsConfig(e),a=(null==t?void 0:t.config)||t||{};u(a),v(JSON.stringify(a,null,2));let[s,l,n,c]=await Promise.allSettled([i.h.getRoles(e),i.h.getChannels(e),i.h.getCategories(e),i.h.getWebhooks(e)]);if("fulfilled"===s.status&&N(s.value.roles||s.value||[]),"fulfilled"===l.status&&w((l.value.channels||l.value||[]).filter(e=>e&&e.id&&e.name)),"fulfilled"===n.status&&_(n.value.categories||n.value||[]),"fulfilled"===c.status){let e=(c.value.webhooks||c.value||[]).map(e=>({id:String(e._id||e.id||"".concat(e.type,":").concat(e.channel_id||"")),name:e.name,type:e.type,url:e.url}));R(e)}}catch(e){p((null==e?void 0:e.message)||C("common.saveFailed"))}finally{x(!1)}}})()},[e]);let z=async()=>{if(e){x(!0),p(null),b(!1);try{let t={};try{let e=JSON.parse(h);e&&"object"==typeof e&&(t=e.tickets&&"object"==typeof e.tickets?{tickets:e.tickets}:"panelChannelId"in e||"staffRoleId"in e||"archiveCategoryId"in e||"logChannelId"in e||"enabled"in e?{tickets:e}:{tickets:{...a.tickets||{}}})}catch(e){t={tickets:{...a.tickets||{}}}}t.tickets||(t.tickets={...a.tickets||{}});let s=await i.h.saveTicketsConfig(e,t),l=(null==s?void 0:s.config)?{...s.config||{}}:{...a,...t||{}};u(l),v(JSON.stringify(l,null,2)),b(!0),y({type:"success",title:C("tickets.saved")})}catch(e){p((null==e?void 0:e.message)||C("common.saveFailed")),y({type:"error",title:C("common.saveFailed"),description:null==e?void 0:e.message})}finally{x(!1)}}},A=(0,l.useMemo)(()=>(null==a?void 0:a.tickets)||{},[a]),D=!!A.panelChannelId&&!I.some(e=>e.id===A.panelChannelId),V=!!A.logChannelId&&!I.some(e=>e.id===A.logChannelId),B=!!A.staffRoleId&&!j.some(e=>e.id===A.staffRoleId),G=!!A.archiveCategoryId&&!S.some(e=>e.id===A.archiveCategoryId);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:C("tickets.config.title")}),(0,s.jsx)("button",{type:"button",onClick:()=>e&&t(e),className:"btn btn-secondary",title:C("tickets.reload"),children:C("tickets.reload")})]}),g&&(0,s.jsx)("div",{className:"text-red-400",children:g}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)("section",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:C("tickets.fields.common")}),(0,s.jsxs)("div",{className:"card-body grid grid-cols-1 gap-3",children:[(0,s.jsx)(m,{label:C("tickets.panelChannelId"),value:A.panelChannelId||"",onChange:e=>u(t=>({...t,tickets:{...t.tickets||{},panelChannelId:e}})),query:E,setQuery:M,options:(0,l.useMemo)(()=>I.filter(e=>r(e)&&e.name.toLowerCase().includes(E.toLowerCase())).map(e=>({value:e.id,label:"#".concat(e.name," (").concat(d(e),")")})),[I,E]),placeholder:"—"}),D&&(0,s.jsx)("div",{className:"text-amber-400 text-xs",children:C("tickets.warn.missingChannel")}),(0,s.jsx)(m,{label:C("tickets.staffRoleId"),value:A.staffRoleId||"",onChange:e=>u(t=>({...t,tickets:{...t.tickets||{},staffRoleId:e}})),query:T,setQuery:q,options:(0,l.useMemo)(()=>j.filter(e=>e.name.toLowerCase().includes(T.toLowerCase())).map(e=>({value:e.id,label:e.name})),[j,T]),placeholder:"—"}),B&&(0,s.jsx)("div",{className:"text-amber-400 text-xs",children:C("tickets.warn.missingRole")}),(0,s.jsx)(m,{label:C("tickets.archiveCategoryId"),value:A.archiveCategoryId||"",onChange:e=>u(t=>({...t,tickets:{...t.tickets||{},archiveCategoryId:e}})),query:O,setQuery:P,options:(0,l.useMemo)(()=>S.filter(e=>e.name.toLowerCase().includes(O.toLowerCase())).map(e=>({value:e.id,label:e.name})),[S,O]),placeholder:"—"}),G&&(0,s.jsx)("div",{className:"text-amber-400 text-xs",children:C("tickets.warn.missingCategory")}),(0,s.jsx)(m,{label:C("tickets.logChannelId"),value:A.logChannelId||"",onChange:e=>u(t=>({...t,tickets:{...t.tickets||{},logChannelId:e}})),query:J,setQuery:Q,options:(0,l.useMemo)(()=>I.filter(e=>r(e)&&e.name.toLowerCase().includes(J.toLowerCase())).map(e=>({value:e.id,label:"#".concat(e.name," (").concat(d(e),")")})),[I,J]),placeholder:"—"}),V&&(0,s.jsx)("div",{className:"text-amber-400 text-xs",children:C("tickets.warn.missingChannel")}),(0,s.jsx)("div",{className:"text-xs text-neutral-400",children:C("tickets.transcriptManagedInWebhooks")}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("label",{className:"text-sm opacity-80",children:C("tickets.enabled")}),(0,s.jsx)("input",{type:"checkbox",checked:!!A.enabled,onChange:e=>u(t=>({...t,tickets:{...t.tickets||{},enabled:e.target.checked}})),title:C("tickets.enabled")})]}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>{let e=(e,t,a)=>{let s=e=>(e||"").toLowerCase();for(let a of t){let t=e.find(e=>a.test(s(e.name)));if(t)return t}return a?a(e):void 0},t=I.filter(r),a=e(t,[/ticket/,/suporte|support/,/help|ajuda/],e=>e[0]),s=e(t,[/log/,/ticket/],e=>e[1]||e[0]),l=e(S,[/arquiv|archive/,/fechad|closed/],e=>e[0]),n=e(j,[/staff|equipa/,/mod/],e=>e.find(e=>/admin|gestor|manager/.test(e.name.toLowerCase()))||e[0]);u(e=>{var t,i,c,o;return{...e,tickets:{...e.tickets||{},panelChannelId:(null==a?void 0:a.id)||(null===(t=e.tickets)||void 0===t?void 0:t.panelChannelId)||"",logChannelId:(null==s?void 0:s.id)||(null===(i=e.tickets)||void 0===i?void 0:i.logChannelId)||"",archiveCategoryId:(null==l?void 0:l.id)||(null===(c=e.tickets)||void 0===c?void 0:c.archiveCategoryId)||"",staffRoleId:(null==n?void 0:n.id)||(null===(o=e.tickets)||void 0===o?void 0:o.staffRoleId)||""}}})},disabled:f,children:C("tickets.config.autofill")}),(0,s.jsx)("button",{type:"button",className:"btn btn-primary",onClick:z,disabled:f,children:C("common.save")}),k&&(0,s.jsx)("span",{className:"text-green-400",children:C("tickets.saved")})]})]})]}),(0,s.jsxs)("section",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:C("tickets.json.editor")}),(0,s.jsxs)("div",{className:"card-body",children:[(0,s.jsx)("textarea",{className:"input min-h-[280px] font-mono",value:h,onChange:e=>v(e.target.value),title:"Editor JSON"}),(0,s.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>v(JSON.stringify(a,null,2)),children:C("tickets.json.revert")}),(0,s.jsx)("button",{type:"button",className:"btn btn-primary",onClick:z,disabled:f,children:C("tickets.json.save")})]})]})]})]})]})}function m(e){let{label:t,value:a,onChange:l,options:n,query:i,setQuery:c,placeholder:o}=e;return(0,s.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,s.jsx)("span",{className:"text-sm opacity-80",children:t}),(0,s.jsx)("input",{className:"input",value:i,onChange:e=>c(e.target.value),placeholder:"Pesquisar…",title:t+" search"}),(0,s.jsxs)("select",{className:"input",value:a,onChange:e=>l(e.target.value),title:t,children:[(0,s.jsx)("option",{value:"",children:o||"—"}),n.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))]})]})}},8183:function(e,t,a){"use strict";a.d(t,{ToasterProvider:function(){return c},p:function(){return i}});var s=a(7437),l=a(2265);let n=(0,l.createContext)(null);function i(){let e=(0,l.useContext)(n);if(!e)throw Error("useToast must be used within <ToasterProvider />");return e}function c(e){let{children:t}=e,[a,i]=(0,l.useState)([]),c=(0,l.useRef)(0),o=(0,l.useCallback)(e=>{i(t=>t.filter(t=>t.id!==e))},[]),r=(0,l.useCallback)(e=>{let t="".concat(Date.now(),"_").concat(c.current++),a={id:t,...e};i(e=>[...e,a]),window.setTimeout(()=>o(t),4500)},[o]),d=(0,l.useMemo)(()=>({toast:r}),[r]);return(0,s.jsxs)(n.Provider,{value:d,children:[t,(0,s.jsx)("div",{className:"fixed z-50 right-4 bottom-4 flex flex-col gap-2 w-[min(92vw,380px)]",role:"status","aria-live":"polite",children:a.map(e=>(0,s.jsxs)("div",{className:"rounded-xl border p-3 shadow-lg backdrop-blur card ".concat("success"===e.type?"border-emerald-700/60":"error"===e.type?"border-rose-700/60":"border-neutral-700/60"),children:[e.title&&(0,s.jsx)("div",{className:"text-sm font-semibold mb-0.5",children:e.title}),e.description&&(0,s.jsx)("div",{className:"text-xs text-neutral-300",children:e.description})]},e.id))})]})}}},function(e){e.O(0,[814,482,971,23,744],function(){return e(e.s=2728)}),_N_E=e.O()}]);