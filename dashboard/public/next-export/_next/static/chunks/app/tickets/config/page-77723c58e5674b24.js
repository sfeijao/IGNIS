(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[922],{2728:function(e,t,a){Promise.resolve().then(a.bind(a,3842))},3842:function(e,t,a){"use strict";a.d(t,{default:function(){return r}});var l=a(7437),s=a(2265),n=a(2837),i=a(9988),c=a(7814);let o=e=>{var t;let a=(null!==(t=null==e?void 0:e.type)&&void 0!==t?t:"").toString().toLowerCase();return""===a||"0"===a||"text"===a||"guild_text"===a||"5"===a||"announcement"===a||"guild_announcement"===a},d=e=>{var t;let a=(null!==(t=null==e?void 0:e.type)&&void 0!==t?t:"").toString().toLowerCase();return"0"===a||"text"===a||"guild_text"===a?"Text":"2"===a||"voice"===a||"guild_voice"===a?"Voice":"4"===a||"category"===a||"guild_category"===a?"Category":"5"===a||"announcement"===a||"guild_announcement"===a?"Announcement":"Channel"};function r(){let[e,t]=(0,s.useState)(null),[a,r]=(0,s.useState)({}),[h,m]=(0,s.useState)(""),[v,g]=(0,s.useState)(!1),[f,x]=(0,s.useState)(null),[k,p]=(0,s.useState)(!1),{t:C}=(0,c.QT)(),[b,y]=(0,s.useState)([]),[j,N]=(0,s.useState)([]),[I,S]=(0,s.useState)([]),[w,_]=(0,s.useState)([]),[L,R]=(0,s.useState)(""),[q,E]=(0,s.useState)(""),[O,M]=(0,s.useState)(""),[J,Q]=(0,s.useState)(""),[T,P]=(0,s.useState)("");(0,s.useEffect)(()=>{t((0,n._)())},[]),(0,s.useEffect)(()=>{(async()=>{if(e){g(!0),x(null),p(!1);try{let t=await i.h.getTicketsConfig(e),a=(null==t?void 0:t.config)||t||{};r(a),m(JSON.stringify(a,null,2));let[l,s,n,c]=await Promise.allSettled([i.h.getRoles(e),i.h.getChannels(e),i.h.getCategories(e),i.h.getWebhooks(e)]);if("fulfilled"===l.status&&y(l.value.roles||l.value||[]),"fulfilled"===s.status&&N((s.value.channels||s.value||[]).filter(e=>e&&e.id&&e.name)),"fulfilled"===n.status&&S(n.value.categories||n.value||[]),"fulfilled"===c.status){let e=(c.value.webhooks||c.value||[]).map(e=>({id:String(e._id||e.id||"".concat(e.type,":").concat(e.channel_id||"")),name:e.name,type:e.type,url:e.url}));_(e)}}catch(e){x((null==e?void 0:e.message)||C("common.saveFailed"))}finally{g(!1)}}})()},[e]);let W=async()=>{if(e){g(!0),x(null),p(!1);try{let t={};try{let e=JSON.parse(h);e&&"object"==typeof e&&(t=e.tickets&&"object"==typeof e.tickets?{tickets:e.tickets}:"panelChannelId"in e||"staffRoleId"in e||"archiveCategoryId"in e||"logChannelId"in e||"enabled"in e?{tickets:e}:{tickets:{...a.tickets||{}}})}catch(e){t={tickets:{...a.tickets||{}}}}t.tickets||(t.tickets={...a.tickets||{}});let l=await i.h.saveTicketsConfig(e,t),s=(null==l?void 0:l.config)?{...l.config||{}}:{...a,...t||{}};r(s),m(JSON.stringify(s,null,2)),p(!0)}catch(e){x((null==e?void 0:e.message)||"Erro ao salvar config")}finally{g(!1)}}},A=(0,s.useMemo)(()=>(null==a?void 0:a.tickets)||{},[a]),F=!!A.panelChannelId&&!j.some(e=>e.id===A.panelChannelId),V=!!A.logChannelId&&!j.some(e=>e.id===A.logChannelId),z=!!A.staffRoleId&&!b.some(e=>e.id===A.staffRoleId),B=!!A.archiveCategoryId&&!I.some(e=>e.id===A.archiveCategoryId);return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold",children:C("tickets.config.title")}),(0,l.jsx)("button",{type:"button",onClick:()=>e&&t(e),className:"btn btn-secondary",title:C("tickets.reload"),children:C("tickets.reload")})]}),f&&(0,l.jsx)("div",{className:"text-red-400",children:f}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsxs)("section",{className:"card",children:[(0,l.jsx)("div",{className:"card-header",children:C("tickets.fields.common")}),(0,l.jsxs)("div",{className:"card-body grid grid-cols-1 gap-3",children:[(0,l.jsx)(u,{label:C("tickets.panelChannelId"),value:A.panelChannelId||"",onChange:e=>r(t=>({...t,tickets:{...t.tickets||{},panelChannelId:e}})),query:q,setQuery:E,options:(0,s.useMemo)(()=>j.filter(e=>o(e)&&e.name.toLowerCase().includes(q.toLowerCase())).map(e=>({value:e.id,label:"#".concat(e.name," (").concat(d(e),")")})),[j,q]),placeholder:"—"}),F&&(0,l.jsx)("div",{className:"text-amber-400 text-xs",children:C("tickets.warn.missingChannel")}),(0,l.jsx)(u,{label:C("tickets.staffRoleId"),value:A.staffRoleId||"",onChange:e=>r(t=>({...t,tickets:{...t.tickets||{},staffRoleId:e}})),query:L,setQuery:R,options:(0,s.useMemo)(()=>b.filter(e=>e.name.toLowerCase().includes(L.toLowerCase())).map(e=>({value:e.id,label:e.name})),[b,L]),placeholder:"—"}),z&&(0,l.jsx)("div",{className:"text-amber-400 text-xs",children:C("tickets.warn.missingRole")}),(0,l.jsx)(u,{label:C("tickets.archiveCategoryId"),value:A.archiveCategoryId||"",onChange:e=>r(t=>({...t,tickets:{...t.tickets||{},archiveCategoryId:e}})),query:O,setQuery:M,options:(0,s.useMemo)(()=>I.filter(e=>e.name.toLowerCase().includes(O.toLowerCase())).map(e=>({value:e.id,label:e.name})),[I,O]),placeholder:"—"}),B&&(0,l.jsx)("div",{className:"text-amber-400 text-xs",children:C("tickets.warn.missingCategory")}),(0,l.jsx)(u,{label:C("tickets.logChannelId"),value:A.logChannelId||"",onChange:e=>r(t=>({...t,tickets:{...t.tickets||{},logChannelId:e}})),query:J,setQuery:Q,options:(0,s.useMemo)(()=>j.filter(e=>o(e)&&e.name.toLowerCase().includes(J.toLowerCase())).map(e=>({value:e.id,label:"#".concat(e.name," (").concat(d(e),")")})),[j,J]),placeholder:"—"}),V&&(0,l.jsx)("div",{className:"text-amber-400 text-xs",children:C("tickets.warn.missingChannel")}),(0,l.jsx)("div",{className:"text-xs text-neutral-400",children:C("tickets.transcriptManagedInWebhooks")}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("label",{className:"text-sm opacity-80",children:C("tickets.enabled")}),(0,l.jsx)("input",{type:"checkbox",checked:!!A.enabled,onChange:e=>r(t=>({...t,tickets:{...t.tickets||{},enabled:e.target.checked}})),title:C("tickets.enabled")})]}),(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>{let e=(e,t,a)=>{let l=e=>(e||"").toLowerCase();for(let a of t){let t=e.find(e=>a.test(l(e.name)));if(t)return t}return a?a(e):void 0},t=j.filter(o),a=e(t,[/ticket/,/suporte|support/,/help|ajuda/],e=>e[0]),l=e(t,[/log/,/ticket/],e=>e[1]||e[0]),s=e(I,[/arquiv|archive/,/fechad|closed/],e=>e[0]),n=e(b,[/staff|equipa/,/mod/],e=>e.find(e=>/admin|gestor|manager/.test(e.name.toLowerCase()))||e[0]);r(e=>{var t,i,c,o;return{...e,tickets:{...e.tickets||{},panelChannelId:(null==a?void 0:a.id)||(null===(t=e.tickets)||void 0===t?void 0:t.panelChannelId)||"",logChannelId:(null==l?void 0:l.id)||(null===(i=e.tickets)||void 0===i?void 0:i.logChannelId)||"",archiveCategoryId:(null==s?void 0:s.id)||(null===(c=e.tickets)||void 0===c?void 0:c.archiveCategoryId)||"",staffRoleId:(null==n?void 0:n.id)||(null===(o=e.tickets)||void 0===o?void 0:o.staffRoleId)||""}}})},disabled:v,children:C("tickets.config.autofill")}),(0,l.jsx)("button",{type:"button",className:"btn btn-primary",onClick:W,disabled:v,children:C("common.save")}),k&&(0,l.jsx)("span",{className:"text-green-400",children:C("tickets.saved")})]})]})]}),(0,l.jsxs)("section",{className:"card",children:[(0,l.jsx)("div",{className:"card-header",children:C("tickets.json.editor")}),(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsx)("textarea",{className:"input min-h-[280px] font-mono",value:h,onChange:e=>m(e.target.value),title:"Editor JSON"}),(0,l.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,l.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:()=>m(JSON.stringify(a,null,2)),children:C("tickets.json.revert")}),(0,l.jsx)("button",{type:"button",className:"btn btn-primary",onClick:W,disabled:v,children:C("tickets.json.save")})]})]})]})]})]})}function u(e){let{label:t,value:a,onChange:s,options:n,query:i,setQuery:c,placeholder:o}=e;return(0,l.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{className:"text-sm opacity-80",children:t}),(0,l.jsx)("input",{className:"input",value:i,onChange:e=>c(e.target.value),placeholder:"Pesquisar…",title:t+" search"}),(0,l.jsxs)("select",{className:"input",value:a,onChange:e=>s(e.target.value),title:t,children:[(0,l.jsx)("option",{value:"",children:o||"—"}),n.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))]})]})}}},function(e){e.O(0,[814,482,971,23,744],function(){return e(e.s=2728)}),_N_E=e.O()}]);