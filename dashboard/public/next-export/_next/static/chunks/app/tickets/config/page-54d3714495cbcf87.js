(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[922],{2728:function(e,t,a){Promise.resolve().then(a.bind(a,3842))},3842:function(e,t,a){"use strict";a.d(t,{default:function(){return d}});var l=a(7437),s=a(2265),n=a(2837),i=a(9988),c=a(7814);let o=e=>{var t;let a=(null!==(t=null==e?void 0:e.type)&&void 0!==t?t:"").toString().toLowerCase();return""===a||"0"===a||"text"===a||"guild_text"===a||"5"===a||"announcement"===a||"guild_announcement"===a},r=e=>{var t;let a=(null!==(t=null==e?void 0:e.type)&&void 0!==t?t:"").toString().toLowerCase();return"0"===a||"text"===a||"guild_text"===a?"Text":"2"===a||"voice"===a||"guild_voice"===a?"Voice":"4"===a||"category"===a||"guild_category"===a?"Category":"5"===a||"announcement"===a||"guild_announcement"===a?"Announcement":"Channel"};function d(){let[e,t]=(0,s.useState)(null),[a,d]=(0,s.useState)({}),[h,m]=(0,s.useState)(""),[g,v]=(0,s.useState)(!1),[f,x]=(0,s.useState)(null),[p,b]=(0,s.useState)(!1),{t:y}=(0,c.QT)(),[C,j]=(0,s.useState)([]),[N,k]=(0,s.useState)([]),[S,w]=(0,s.useState)([]),[_,I]=(0,s.useState)([]),[L,E]=(0,s.useState)(""),[O,q]=(0,s.useState)(""),[J,M]=(0,s.useState)(""),[Q,R]=(0,s.useState)(""),[T,P]=(0,s.useState)("");(0,s.useEffect)(()=>{t((0,n._)())},[]),(0,s.useEffect)(()=>{(async()=>{if(e){v(!0),x(null),b(!1);try{let t=await i.h.getTicketsConfig(e),a=(null==t?void 0:t.config)||t||{};d(a),m(JSON.stringify(a,null,2));let[l,s,n,c]=await Promise.allSettled([i.h.getRoles(e),i.h.getChannels(e),i.h.getCategories(e),i.h.getWebhooks(e)]);if("fulfilled"===l.status&&j(l.value.roles||l.value||[]),"fulfilled"===s.status&&k((s.value.channels||s.value||[]).filter(e=>e&&e.id&&e.name)),"fulfilled"===n.status&&w(n.value.categories||n.value||[]),"fulfilled"===c.status){let e=(c.value.webhooks||c.value||[]).map(e=>({id:String(e._id||e.id||"".concat(e.type,":").concat(e.channel_id||"")),name:e.name,type:e.type,url:e.url}));I(e)}}catch(e){x((null==e?void 0:e.message)||y("common.saveFailed"))}finally{v(!1)}}})()},[e]);let W=async()=>{if(e){v(!0),x(null),b(!1);try{let t=a;try{t=JSON.parse(h)}catch(e){}let l=await i.h.saveTicketsConfig(e,t),s=(null==l?void 0:l.config)||t;d(s),m(JSON.stringify(s,null,2)),b(!0)}catch(e){x((null==e?void 0:e.message)||"Erro ao salvar config")}finally{v(!1)}}};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold",children:y("tickets.config.title")}),(0,l.jsx)("button",{onClick:()=>e&&t(e),className:"btn btn-secondary",title:y("tickets.reload"),children:y("tickets.reload")})]}),f&&(0,l.jsx)("div",{className:"text-red-400",children:f}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsxs)("section",{className:"card",children:[(0,l.jsx)("div",{className:"card-header",children:y("tickets.fields.common")}),(0,l.jsxs)("div",{className:"card-body grid grid-cols-1 gap-3",children:[(0,l.jsx)(u,{label:y("tickets.panelChannelId"),value:a.panelChannelId||"",onChange:e=>d(t=>({...t,panelChannelId:e})),query:O,setQuery:q,options:(0,s.useMemo)(()=>N.filter(e=>o(e)&&e.name.toLowerCase().includes(O.toLowerCase())).map(e=>({value:e.id,label:"#".concat(e.name," (").concat(r(e),")")})),[N,O]),placeholder:"—"}),(0,l.jsx)(u,{label:y("tickets.staffRoleId"),value:a.staffRoleId||"",onChange:e=>d(t=>({...t,staffRoleId:e})),query:L,setQuery:E,options:(0,s.useMemo)(()=>C.filter(e=>e.name.toLowerCase().includes(L.toLowerCase())).map(e=>({value:e.id,label:e.name})),[C,L]),placeholder:"—"}),(0,l.jsx)(u,{label:y("tickets.archiveCategoryId"),value:a.archiveCategoryId||"",onChange:e=>d(t=>({...t,archiveCategoryId:e})),query:J,setQuery:M,options:(0,s.useMemo)(()=>S.filter(e=>e.name.toLowerCase().includes(J.toLowerCase())).map(e=>({value:e.id,label:e.name})),[S,J]),placeholder:"—"}),(0,l.jsx)(u,{label:y("tickets.logChannelId"),value:a.logChannelId||"",onChange:e=>d(t=>({...t,logChannelId:e})),query:Q,setQuery:R,options:(0,s.useMemo)(()=>N.filter(e=>o(e)&&e.name.toLowerCase().includes(Q.toLowerCase())).map(e=>({value:e.id,label:"#".concat(e.name," (").concat(r(e),")")})),[N,Q]),placeholder:"—"}),(0,l.jsx)("div",{className:"text-xs text-neutral-400",children:y("tickets.transcriptManagedInWebhooks")}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("label",{className:"text-sm opacity-80",children:y("tickets.enabled")}),(0,l.jsx)("input",{type:"checkbox",checked:!!a.enabled,onChange:e=>d(t=>({...t,enabled:e.target.checked})),title:y("tickets.enabled")})]}),(0,l.jsx)("button",{className:"btn btn-primary w-fit",onClick:W,disabled:g,children:y("common.save")}),p&&(0,l.jsx)("span",{className:"text-green-400",children:y("tickets.saved")})]})]}),(0,l.jsxs)("section",{className:"card",children:[(0,l.jsx)("div",{className:"card-header",children:y("tickets.json.editor")}),(0,l.jsxs)("div",{className:"card-body",children:[(0,l.jsx)("textarea",{className:"input min-h-[280px] font-mono",value:h,onChange:e=>m(e.target.value),title:"Editor JSON"}),(0,l.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,l.jsx)("button",{className:"btn btn-secondary",onClick:()=>m(JSON.stringify(a,null,2)),children:y("tickets.json.revert")}),(0,l.jsx)("button",{className:"btn btn-primary",onClick:W,disabled:g,children:y("tickets.json.save")})]})]})]})]})]})}function u(e){let{label:t,value:a,onChange:s,options:n,query:i,setQuery:c,placeholder:o}=e;return(0,l.jsxs)("label",{className:"flex flex-col gap-1",children:[(0,l.jsx)("span",{className:"text-sm opacity-80",children:t}),(0,l.jsx)("input",{className:"input",value:i,onChange:e=>c(e.target.value),placeholder:"Pesquisar…",title:t+" search"}),(0,l.jsxs)("select",{className:"input",value:a,onChange:e=>s(e.target.value),title:t,children:[(0,l.jsx)("option",{value:"",children:o||"—"}),n.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))]})]})}}},function(e){e.O(0,[814,482,971,23,744],function(){return e(e.s=2728)}),_N_E=e.O()}]);