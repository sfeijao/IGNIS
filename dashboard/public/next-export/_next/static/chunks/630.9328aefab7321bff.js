"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[630],{7630:function(e,t,a){a.r(t),a.d(t,{default:function(){return o}});var n=a(7437),l=a(2265),i=a(2837),c=a(7814),r=a(9988);let s=e=>{let t=String(e.type||"").toLowerCase();return t.includes("text")||t.includes("announcement")},d=e=>{switch(String("string"==typeof e?e:(null==e?void 0:e.type)||"").toLowerCase()){case"guild_text":case"text":return"Text";case"guild_announcement":case"announcement":return"Announcement";case"guild_voice":case"voice":return"Voice";case"guild_category":case"category":return"Category";default:return"Channel"}};function o(){let e=(0,i._)(),[t,a]=(0,l.useState)({enabled:!1,method:"captcha",channelId:"",roleId:""}),[o,u]=(0,l.useState)(!1),[h,m]=(0,l.useState)("idle"),[v,x]=(0,l.useState)([]),[f,p]=(0,l.useState)([]),{t:b}=(0,c.QT)();(0,l.useEffect)(()=>{if(!e)return;let t=!1;return(async()=>{try{let n=await fetch("/api/guild/".concat(e,"/verification/config"),{credentials:"include"});if(n.ok){let e=await n.json();t||a({enabled:!!e.enabled,channelId:e.channelId||"",roleId:e.roleId||"",method:e.method||"captcha"})}}catch(e){}try{let a=await r.h.getChannels(e);t||x(a.channels||a||[])}catch(e){}try{let a=await r.h.getRoles(e);t||p(a.roles||a||[])}catch(e){}})(),()=>{t=!0}},[e]);let g=(0,l.useMemo)(()=>v.filter(s),[v]),j=async()=>{if(e){u(!0),m("saving");try{let a=await fetch("/api/guild/".concat(e,"/verification/config"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});m(a.ok?"ok":"err")}catch(e){m("err")}finally{u(!1),setTimeout(()=>m("idle"),1500)}}};return(0,n.jsxs)("div",{className:"space-y-3",children:[!e&&(0,n.jsx)("div",{className:"card p-4 text-sm text-neutral-400",children:b("verification.selectGuild")}),(0,n.jsxs)("form",{className:"card p-5 max-w-xl space-y-4",onSubmit:e=>{e.preventDefault(),j()},children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{id:"v-enabled",type:"checkbox",checked:!!t.enabled,onChange:e=>a(t=>({...t,enabled:e.target.checked}))}),(0,n.jsx)("label",{htmlFor:"v-enabled",children:b("verification.enable")})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm mb-1",children:b("verification.method")}),(0,n.jsxs)("select",{className:"w-full rounded-lg bg-neutral-900 border border-neutral-800 px-3 py-2",value:t.method,onChange:e=>a(t=>({...t,method:e.target.value})),title:"M\xe9todo de verifica\xe7\xe3o",children:[(0,n.jsx)("option",{value:"captcha",children:b("verification.method.captcha")}),(0,n.jsx)("option",{value:"button",children:b("verification.method.button")})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm mb-1",children:b("verification.channel")}),(0,n.jsxs)("select",{className:"w-full rounded-lg bg-neutral-900 border border-neutral-800 px-3 py-2",value:t.channelId||"",onChange:e=>a(t=>({...t,channelId:e.target.value})),title:b("verification.channel"),children:[(0,n.jsx)("option",{value:"",children:"—"}),g.map(e=>(0,n.jsx)("option",{value:e.id,children:"#".concat(e.name," (").concat(d(e),")")},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm mb-1",children:b("verification.role")}),(0,n.jsxs)("select",{className:"w-full rounded-lg bg-neutral-900 border border-neutral-800 px-3 py-2",value:t.roleId||"",onChange:e=>a(t=>({...t,roleId:e.target.value})),title:b("verification.role"),children:[(0,n.jsx)("option",{value:"",children:"—"}),f.map(e=>(0,n.jsx)("option",{value:e.id,children:"@".concat(e.name)},e.id))]})]}),(0,n.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,n.jsx)("button",{disabled:o,className:"px-4 py-2 rounded-lg bg-brand-600 hover:bg-brand-700 font-medium disabled:opacity-60",children:b("saving"===h?"verification.saving":"verification.save")}),"ok"===h&&(0,n.jsx)("span",{className:"text-emerald-400 text-sm",children:b("verification.saved")}),"err"===h&&(0,n.jsx)("span",{className:"text-rose-400 text-sm",children:b("verification.saveFailed")})]})]})]})}}}]);