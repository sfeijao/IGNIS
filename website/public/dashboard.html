<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Central de Atendimento ‚Ä¢ IGNIS</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; margin:0; background:#0F1419; color:#E6E8EB }
    .container { max-width:1160px; margin:0 auto; padding:0 20px }
    .navbar { background:#121826; border-bottom:1px solid #1B2233; position:sticky; top:0; z-index:100 }
    .navbar-content { display:flex; justify-content:space-between; align-items:center; height:64px }
    .navbar-brand { font-size:20px; font-weight:700; color:#cdd6f4; display:flex; align-items:center; gap:10px }
    .ignis-logo { color:#8B5CF6 }
    .navbar-user { display:flex; align-items:center; gap:12px; color:#bac2de }
    .user-avatar { width:32px; height:32px; border-radius:50%; border:2px solid #2C3350; background:#8B5CF6; display:flex; align-items:center; justify-content:center }
    .nav-btn { color:#fff; text-decoration:none; padding:8px 14px; background:#6D28D9; border-radius:6px }
    .nav-btn:hover { background:#7C3AED }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-content container">
      <div class="navbar-brand">üî• <span class="ignis-logo">IGNIS</span> ‚Ä¢ Central</div>
      <div class="navbar-user">
        <div class="user-avatar" aria-hidden="true">üë§</div>
        <span id="userName">Utilizador</span>
        <a href="/logout" class="nav-btn" aria-label="Terminar sess√£o">Sair</a>
      </div>
    </div>
  </nav>

  <main class="container">
    <!-- Hero -->
    <section class="hero" aria-labelledby="hero-title">
      <div class="hero-text">
        <h1 id="hero-title">Central de Atendimento</h1>
        <p class="hero-sub">Clique no departamento para abrir um atendimento privado.<br/>Tempo m√©dio de resposta: <strong>15 minutos</strong>.</p>

        <div class="pills" role="status" aria-live="polite">
          <span class="pill" id="pill-guild">üè∑Ô∏è <span data-guild-name>Servidor</span></span>
          <span class="pill" id="pill-staff">üë• Staff online: <span data-staff-online>‚Äî</span></span>
          <span class="pill status" id="pill-status" data-status="online">‚óè <span data-system-status>ONLINE</span></span>
        </div>

        <div class="actions">
          <button class="btn btn-primary" data-ticket="technical" aria-label="Abrir ticket de suporte t√©cnico">
            üîß SUPORTE T√âCNICO
          </button>
          <button class="btn btn-danger" data-ticket="incident" aria-label="Reportar um problema">
            ‚ö†Ô∏è REPORTAR PROBLEMA
          </button>
          <button class="btn btn-neutral" data-ticket="moderation" aria-label="Abrir ticket de modera√ß√£o e seguran√ßa">
            ÔøΩÔ∏è MODERA√á√ÉO
          </button>
        </div>

        <div class="feedback" role="alert" aria-live="assertive" hidden></div>
      </div>
      <div class="hero-art">
        <img src="https://images.unsplash.com/photo-1542751371-adc38448a05e?w=1200&h=420&fit=crop&crop=center" alt="Banner IGNIS" />
      </div>
    </section>

    <!-- Cards -->
    <section class="cards" aria-label="Departamentos de atendimento">
      <article class="card">
        <img class="card-img" src="https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=840&h=280&fit=crop&crop=center" alt="Suporte T√©cnico" />
        <div class="card-body">
          <h3>üîß Suporte T√©cnico</h3>
          <ul>
            <li>Configura√ß√£o de bots e integra√ß√µes</li>
            <li>Ajuda com comandos e permiss√µes</li>
            <li>Melhorias simples de performance</li>
          </ul>
        </div>
      </article>
      <article class="card">
        <img class="card-img" src="https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=840&h=280&fit=crop&crop=center" alt="Reportar Problema" />
        <div class="card-body">
          <h3>‚ö†Ô∏è Reportar Problema</h3>
          <ul>
            <li>Erros, bugs e instabilidades</li>
            <li>Comportamentos inesperados</li>
            <li>Partilha de prints e evid√™ncias</li>
          </ul>
        </div>
      </article>
      <article class="card">
        <img class="card-img" src="https://images.unsplash.com/photo-1584438784894-089d6a62b8fa?w=840&h=280&fit=crop&crop=center" alt="Modera√ß√£o e Seguran√ßa" />
        <div class="card-body">
          <h3>üõ°Ô∏è Modera√ß√£o & Seguran√ßa</h3>
          <ul>
            <li>Den√∫ncias e investiga√ß√µes</li>
            <li>Quest√µes de regras e disciplina</li>
            <li>Suporte reservado</li>
          </ul>
        </div>
      </article>
    </section>

    <!-- Banner final / identidade visual -->
    <section class="identity" aria-hidden="true">
      <img src="https://images.unsplash.com/photo-1511512578047-dfb367046420?w=1200&h=300&fit=crop&crop=center" alt="Identidade IGNIS" />
    </section>

    <footer class="footer">
      <span>Sistema v2.1 ‚Ä¢ Powered by IGNIS</span>
    </footer>
  </main>

  <script>
    // Pequeno helper para set de texto seguro
    const setText = (sel, text) => {
      const el = document.querySelector(sel);
      if (el) el.textContent = text;
    };

    // Carregar dados do utilizador e guilds
    async function initDashboard() {
      try {
        const userRes = await fetch('/api/user');
        if (userRes.ok) {
          const u = await userRes.json();
          if (u?.success) setText('#userName', u.user.username);
        }

        // Tentar obter guild atual a partir do primeiro dispon√≠vel
        const gRes = await fetch('/api/guilds');
        if (!gRes.ok) return;
        const gData = await gRes.json();
        const guild = gData.guilds?.[0];
        if (!guild) return;

        document.querySelector('[data-guild-name]').textContent = guild.name;

        // Stats do guild
        const statsRes = await fetch(`/api/guild/${guild.id}/stats`);
        if (statsRes.ok) {
          const s = await statsRes.json();
          if (s?.success) {
            document.querySelector('[data-staff-online]').textContent = s.stats.onlineCount || 0;
          }
        }

        // Tickets para status do sistema simples
        const ticketsRes = await fetch(`/api/guild/${guild.id}/tickets`);
        if (ticketsRes.ok) {
          const t = await ticketsRes.json();
          if (t?.success) {
            // Heur√≠stica simples de status
            const open = t.stats.open || 0;
            const statusEl = document.getElementById('pill-status');
            const labelEl = document.querySelector('[data-system-status]');
            if (open < 5) {
              statusEl.dataset.status = 'online';
              labelEl.textContent = 'ONLINE';
            } else if (open < 15) {
              statusEl.dataset.status = 'degraded';
              labelEl.textContent = 'DEGRADED';
            } else {
              statusEl.dataset.status = 'offline';
              labelEl.textContent = 'OFFLINE';
            }
          }
        }
      } catch (e) {
        // Falha silenciosa para n√£o quebrar UI
      }
    }

    // Bot√µes de a√ß√£o com feedback imediato
    function setupButtons() {
      const feedback = document.querySelector('.feedback');
      const buttons = document.querySelectorAll('[data-ticket]');
      buttons.forEach(btn => {
        btn.addEventListener('click', async () => {
          const type = btn.getAttribute('data-ticket');
          const original = btn.textContent;
          btn.disabled = true;
          btn.classList.add('loading');
          btn.textContent = 'A criar‚Ä¶';
          try {
            // A√ß√£o no Discord √© via bot√£o no servidor, aqui simulamos um feedback
            // Opcionalmente poder√≠amos abrir um deep-link ou instru√ß√£o.
            await new Promise(r => setTimeout(r, 800));
            feedback.hidden = false;
            feedback.textContent = `‚úÖ Pedido enviado: ${type.toUpperCase()}. Verifica o Discord para o canal privado.`;
            setTimeout(() => { feedback.hidden = true; }, 4000);
          } finally {
            btn.disabled = false;
            btn.classList.remove('loading');
            btn.textContent = original;
          }
        });
      });
    }

    initDashboard();
    setupButtons();
  </script>
</body>
</html>
