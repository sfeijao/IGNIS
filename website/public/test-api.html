<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ YSNM API Test Dashboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0F1419;
            color: #FFFFFF;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { color: #6B73FF; text-align: center; margin-bottom: 2rem; }
        .test-section { 
            background: #1A1F2E; 
            border-radius: 12px; 
            padding: 20px; 
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .test-section h3 { color: #8B5CF6; margin-bottom: 15px; }
        .btn {
            background: #6B73FF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .btn:hover { background: #5A63E8; }
        .btn.success { background: #10B981; }
        .btn.error { background: #EF4444; }
        .result {
            background: #252A3A;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            border-left: 4px solid #6B73FF;
            white-space: pre-wrap;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .status { 
            display: inline-block; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 12px; 
            font-weight: bold;
        }
        .status.success { background: #10B981; }
        .status.error { background: #EF4444; }
        .status.loading { background: #F59E0B; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .api-info { font-size: 12px; color: #94A3B8; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ YSNM API Test Dashboard</h1>
        <p style="text-align: center; color: #94A3B8; margin-bottom: 2rem;">
            Teste completo de todas as APIs do sistema YSNM
        </p>

        <div class="grid">
            <!-- Guilds API -->
            <div class="test-section">
                <h3>üè† Guilds API</h3>
                <div class="api-info">GET /api/guilds</div>
                <button class="btn" onclick="testGuilds()">Testar Guilds</button>
                <span id="guilds-status" class="status loading">Aguardando...</span>
                <div id="guilds-result" class="result" style="display: none;"></div>
            </div>

            <!-- Channels API -->
            <div class="test-section">
                <h3>üì∫ Channels API</h3>
                <div class="api-info">GET /api/server/{serverId}/channels</div>
                <button class="btn" onclick="testChannels()">Testar Channels</button>
                <span id="channels-status" class="status loading">Aguardando...</span>
                <div id="channels-result" class="result" style="display: none;"></div>
            </div>

            <!-- Roles API -->
            <div class="test-section">
                <h3>üëë Roles API</h3>
                <div class="api-info">GET /api/server/{serverId}/roles</div>
                <button class="btn" onclick="testRoles()">Testar Roles</button>
                <span id="roles-status" class="status loading">Aguardando...</span>
                <div id="roles-result" class="result" style="display: none;"></div>
            </div>

            <!-- Members API -->
            <div class="test-section">
                <h3>üë• Members API</h3>
                <div class="api-info">GET /api/server/{serverId}/members</div>
                <button class="btn" onclick="testMembers()">Testar Members</button>
                <span id="members-status" class="status loading">Aguardando...</span>
                <div id="members-result" class="result" style="display: none;"></div>
            </div>

            <!-- Tickets API -->
            <div class="test-section">
                <h3>üé´ Tickets API</h3>
                <div class="api-info">GET /api/tickets</div>
                <button class="btn" onclick="testTickets()">Testar Tickets</button>
                <span id="tickets-status" class="status loading">Aguardando...</span>
                <div id="tickets-result" class="result" style="display: none;"></div>
            </div>

            <!-- Logs API -->
            <div class="test-section">
                <h3>üìä Logs API</h3>
                <div class="api-info">GET /api/logs</div>
                <button class="btn" onclick="testLogs()">Testar Logs</button>
                <span id="logs-status" class="status loading">Aguardando...</span>
                <div id="logs-result" class="result" style="display: none;"></div>
            </div>

            <!-- Moderation APIs -->
            <div class="test-section">
                <h3>üõ°Ô∏è Moderation Tests</h3>
                <div class="api-info">POST /api/server/{serverId}/timeout (dry-run)</div>
                <button class="btn" onclick="testModeration()">Testar Modera√ß√£o</button>
                <span id="moderation-status" class="status loading">Aguardando...</span>
                <div id="moderation-result" class="result" style="display: none;"></div>
            </div>

            <!-- System Status -->
            <div class="test-section">
                <h3>‚öôÔ∏è System Status</h3>
                <div class="api-info">Informa√ß√µes do sistema</div>
                <button class="btn" onclick="testSystemStatus()">Verificar Sistema</button>
                <span id="system-status" class="status loading">Aguardando...</span>
                <div id="system-result" class="result" style="display: none;"></div>
            </div>
        </div>

        <div class="test-section" style="margin-top: 30px;">
            <h3>üîÑ Teste Completo</h3>
            <button class="btn" onclick="runAllTests()" style="font-size: 16px; padding: 15px 30px;">
                ‚ñ∂Ô∏è Executar Todos os Testes
            </button>
            <div id="overall-status" style="margin-top: 15px; font-size: 18px; text-align: center;"></div>
        </div>
    </div>

    <script>
        const SERVER_ID = '1333820000791691284'; // ID real do servidor

        async function makeApiCall(endpoint, method = 'GET', body = null) {
            try {
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                
                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(endpoint, options);
                const data = await response.json();
                
                return {
                    success: response.ok,
                    status: response.status,
                    data: data
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        function updateStatus(testName, success, message = '') {
            const statusEl = document.getElementById(`${testName}-status`);
            const resultEl = document.getElementById(`${testName}-result`);
            
            statusEl.className = `status ${success ? 'success' : 'error'}`;
            statusEl.textContent = success ? '‚úÖ Sucesso' : '‚ùå Erro';
            
            if (message) {
                resultEl.style.display = 'block';
                resultEl.textContent = message;
            }
        }

        async function testGuilds() {
            console.log('üè† Testando Guilds API...');
            const result = await makeApiCall('/api/guilds');
            
            if (result.success) {
                const guilds = result.data.guilds || [];
                const message = `‚úÖ ${guilds.length} servidor(es) encontrado(s)\n\n${JSON.stringify(result.data, null, 2)}`;
                updateStatus('guilds', true, message);
            } else {
                updateStatus('guilds', false, `‚ùå Erro: ${result.error || result.data?.error || 'Falha na API'}`);
            }
        }

        async function testChannels() {
            console.log('üì∫ Testando Channels API...');
            const result = await makeApiCall(`/api/server/${SERVER_ID}/channels`);
            
            if (result.success) {
                const channels = result.data.channels || [];
                const message = `‚úÖ ${channels.length} canal(is) encontrado(s)\n\n${JSON.stringify(result.data, null, 2)}`;
                updateStatus('channels', true, message);
            } else {
                updateStatus('channels', false, `‚ùå Erro: ${result.error || result.data?.error || 'Falha na API'}`);
            }
        }

        async function testRoles() {
            console.log('üëë Testando Roles API...');
            const result = await makeApiCall(`/api/server/${SERVER_ID}/roles`);
            
            if (result.success) {
                const roles = result.data.roles || [];
                const message = `‚úÖ ${roles.length} cargo(s) encontrado(s)\n\n${JSON.stringify(result.data, null, 2)}`;
                updateStatus('roles', true, message);
            } else {
                updateStatus('roles', false, `‚ùå Erro: ${result.error || result.data?.error || 'Falha na API'}`);
            }
        }

        async function testMembers() {
            console.log('üë• Testando Members API...');
            const result = await makeApiCall(`/api/server/${SERVER_ID}/members`);
            
            if (result.success) {
                const members = result.data.members || [];
                const message = `‚úÖ ${members.length} membro(s) encontrado(s)\n\n${JSON.stringify(result.data, null, 2)}`;
                updateStatus('members', true, message);
            } else {
                updateStatus('members', false, `‚ùå Erro: ${result.error || result.data?.error || 'Falha na API'}`);
            }
        }

        async function testTickets() {
            console.log('üé´ Testando Tickets API...');
            const result = await makeApiCall('/api/tickets');
            
            if (result.success) {
                const tickets = result.data.tickets || [];
                const message = `‚úÖ ${tickets.length} ticket(s) encontrado(s)\n\n${JSON.stringify(result.data, null, 2)}`;
                updateStatus('tickets', true, message);
            } else {
                updateStatus('tickets', false, `‚ùå Erro: ${result.error || result.data?.error || 'Falha na API'}`);
            }
        }

        async function testLogs() {
            console.log('üìä Testando Logs API...');
            const result = await makeApiCall('/api/logs');
            
            if (result.success) {
                const logs = result.data.logs || [];
                const message = `‚úÖ ${logs.length} log(s) encontrado(s)\n\n${JSON.stringify(result.data, null, 2)}`;
                updateStatus('logs', true, message);
            } else {
                updateStatus('logs', false, `‚ùå Erro: ${result.error || result.data?.error || 'Falha na API'}`);
            }
        }

        async function testModeration() {
            console.log('üõ°Ô∏è Testando Moderation API...');
            // Teste dry-run (sem executar a√ß√£o real)
            const message = `‚ÑπÔ∏è Teste de modera√ß√£o (simula√ß√£o)\n\nEndpoints dispon√≠veis:\n- POST /api/server/${SERVER_ID}/timeout\n- POST /api/server/${SERVER_ID}/kick\n- POST /api/server/${SERVER_ID}/ban\n- POST /api/server/${SERVER_ID}/unban-all\n- POST /api/server/${SERVER_ID}/lock\n\n‚ö†Ô∏è Testes reais de modera√ß√£o requerem IDs de usu√°rio v√°lidos`;
            updateStatus('moderation', true, message);
        }

        async function testSystemStatus() {
            console.log('‚öôÔ∏è Verificando System Status...');
            
            const systemInfo = {
                timestamp: new Date().toISOString(),
                server: 'localhost:4000',
                environment: 'development',
                features: {
                    authentication: '‚úÖ Bypass ativo (dev)',
                    database: '‚úÖ SQLite conectado',
                    discordBot: '‚úÖ Bot online',
                    apiEndpoints: '‚úÖ Funcionais'
                }
            };
            
            const message = `‚úÖ Sistema funcionando corretamente\n\n${JSON.stringify(systemInfo, null, 2)}`;
            updateStatus('system', true, message);
        }

        async function runAllTests() {
            const overallStatus = document.getElementById('overall-status');
            overallStatus.innerHTML = 'üîÑ Executando todos os testes...';
            
            const tests = [
                { name: 'Guilds', fn: testGuilds },
                { name: 'Channels', fn: testChannels },
                { name: 'Roles', fn: testRoles },
                { name: 'Members', fn: testMembers },
                { name: 'Tickets', fn: testTickets },
                { name: 'Logs', fn: testLogs },
                { name: 'Moderation', fn: testModeration },
                { name: 'System', fn: testSystemStatus }
            ];
            
            let passed = 0;
            
            for (const test of tests) {
                try {
                    await test.fn();
                    passed++;
                    await new Promise(resolve => setTimeout(resolve, 500)); // Delay entre testes
                } catch (error) {
                    console.error(`‚ùå Teste ${test.name} falhou:`, error);
                }
            }
            
            const total = tests.length;
            const success = passed === total;
            
            overallStatus.innerHTML = `
                <div style="color: ${success ? '#10B981' : '#F59E0B'}">
                    ${success ? 'üéâ' : '‚ö†Ô∏è'} Testes completos: ${passed}/${total} passaram
                    ${success ? '<br>‚úÖ Sistema YSNM 100% funcional!' : '<br>‚ö†Ô∏è Alguns componentes precisam de aten√ß√£o'}
                </div>
            `;
        }

        // Auto-executar teste b√°sico ao carregar
        window.addEventListener('load', () => {
            console.log('üß™ YSNM API Test Dashboard carregado');
            setTimeout(() => {
                testSystemStatus();
            }, 1000);
        });
    </script>
</body>
</html>
