<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Teste Simples YSNM</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- simple-test styles moved to css/style.css (.test-page) -->
</head>
<body>
    <!-- helpers loaded at end of body -->
    <div class="container test-page">
        <h1>üîß Teste Simples YSNM</h1>
        <p>Teste b√°sico para verificar JavaScript e APIs</p>
        
        <button class="btn" onclick="testeBasico()">1. Teste JavaScript B√°sico</button>
        <div id="resultado1" class="result">Clique no bot√£o acima...</div>
        
        <button class="btn" onclick="testeAPI()">2. Teste API Simples</button>
        <div id="resultado2" class="result">Clique no bot√£o acima...</div>
        
        <button class="btn" onclick="testeCompleto()">3. Teste Completo</button>
        <div id="resultado3" class="result">Clique no bot√£o acima...</div>
        
        <h3>Estado do Console:</h3>
        <div id="console-log" class="result">Aguardando...</div>
    </div>

    </script>
    <!-- Include DOMPurify then frontend helpers once at end of body -->
    <script src="/js/dompurify.min.js"></script>
    <script src="/js/frontend-helpers.js"></script>
</body>
</html>
        const originalLog = console.log;
        const originalError = console.error;
        
        function logToDiv(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6666' : '#66ff66';
            const entry = document.createElement('div');
            entry.style.color = color;
            entry.textContent = '[' + timestamp + '] ' + message;
            consoleDiv.appendChild(entry);
        }

        function appendResult(el, text, clear = false) {
            if (clear) { while (el.firstChild) el.removeChild(el.firstChild); }
            const line = document.createElement('div');
            line.textContent = text;
            el.appendChild(line);
        }
        
        console.log = function(...args) {
            logToDiv('LOG: ' + args.join(' '), 'log');
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logToDiv('ERROR: ' + args.join(' '), 'error');
            originalError.apply(console, args);
        };

        // Capturar erros globais
        window.addEventListener('error', function(event) {
            logToDiv('ERRO GLOBAL: ' + (event.error?.message || event.message), 'error');
        });

        function testeBasico() {
            const resultado = document.getElementById('resultado1');
            resultado.className = 'result';
            appendResult(resultado, 'Executando teste b√°sico...', true);
            try {
                // Teste 1: Vari√°veis
                const teste = 'Ol√° mundo!';
                appendResult(resultado, '‚úÖ Vari√°veis: ' + teste);
                
                // Teste 2: Fun√ß√µes
                function soma(a, b) { return a + b; }
                const resultadoSoma = soma(2, 3);
                appendResult(resultado, '‚úÖ Fun√ß√µes: 2 + 3 = ' + resultadoSoma);
                
                // Teste 3: DOM
                const elemento = document.getElementById('resultado1');
                appendResult(resultado, '‚úÖ DOM: Elemento encontrado = ' + (elemento ? 'Sim' : 'N√£o'));
                
                // Teste 4: Fetch dispon√≠vel
                appendResult(resultado, '‚úÖ Fetch API: ' + (typeof fetch === 'function' ? 'Dispon√≠vel' : 'N√£o dispon√≠vel'));
                
                console.log('‚úÖ Teste b√°sico completado com sucesso');
                resultado.className = 'result success';
                appendResult(resultado, 'üéâ TESTE B√ÅSICO: SUCESSO!');
                
            } catch (error) {
                console.error('‚ùå Erro no teste b√°sico:', error);
                resultado.className = 'result error';
                appendResult(resultado, '‚ùå ERRO: ' + (error.message || ''));
            }
        }

        function testeAPI() {
            const resultado = document.getElementById('resultado2');
            resultado.className = 'result';
            appendResult(resultado, 'Testando APIs...', true);
            
            // Teste API de usu√°rio
            fetch('/api/user')
                .then(response => {
                    appendResult(resultado, 'Status /api/user: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    appendResult(resultado, 'Resposta /api/user: ' + JSON.stringify(data, null, 2));
                    console.log('‚úÖ API /api/user funcionando');
                    
                    // Teste API de guilds
                    return fetch('/api/guilds');
                })
                .then(response => {
                    appendResult(resultado, 'Status /api/guilds: ' + response.status);
                    return response.json();
                })
                .then(data => {
                    appendResult(resultado, 'Resposta /api/guilds: ' + JSON.stringify(data, null, 2));
                    console.log('‚úÖ API /api/guilds funcionando');
                    resultado.className = 'result success';
                    appendResult(resultado, 'üéâ TESTE API: SUCESSO!');
                })
                .catch(error => {
                    console.error('‚ùå Erro na API:', error);
                    resultado.className = 'result error';
                    appendResult(resultado, '‚ùå ERRO API: ' + (error.message || ''));
                });
        }

        function testeCompleto() {
            const resultado = document.getElementById('resultado3');
            resultado.className = 'result';
            appendResult(resultado, 'Executando teste completo...', true);
            
                console.log('üöÄ Iniciando teste completo');
            
            // Simular o fluxo do dashboard
            Promise.all([
                fetch('/api/user'),
                fetch('/api/guilds')
            ])
            .then(responses => {
                appendResult(resultado, 'Respostas recebidas: ' + responses.length);
                
                const statusCodes = responses.map(r => r.status);
                appendResult(resultado, 'Status codes: ' + statusCodes.join(', '));
                
                return Promise.all(responses.map(r => r.json()));
            })
            .then(([userData, guildsData]) => {
                appendResult(resultado, 'Dados recebidos:');
                appendResult(resultado, 'User success: ' + userData.success);
                appendResult(resultado, 'Guilds success: ' + guildsData.success);
                
                    if (userData.success && guildsData.success) {
                    appendResult(resultado, 'Username: ' + (userData.user?.username || 'Developer'));
                    appendResult(resultado, 'Guilds count: ' + (guildsData.guilds?.length || 0));
                    
            if (guildsData.guilds && guildsData.guilds.length > 0) {
                const firstGuild = guildsData.guilds[0];
                appendResult(resultado, 'Testando primeiro servidor: ' + (firstGuild.name || ''));
                        
                return fetch('/api/server/' + encodeURIComponent(firstGuild.id) + '/stats');
                    } else {
                        throw new Error('Nenhum servidor encontrado');
                    }
                } else {
                    throw new Error('Falha na autentica√ß√£o ou guilds');
                }
            })
            .then(response => {
                    appendResult(resultado, 'Status stats: ' + response.status);
                return response.json();
            })
            .then(statsData => {
                appendResult(resultado, 'Stats success: ' + statsData.success);
                
                if (statsData.success) {
                    appendResult(resultado, 'Stats: ' + JSON.stringify(statsData.stats, null, 2));
                    console.log('‚úÖ Teste completo bem-sucedido');
                    resultado.className = 'result success';
                    appendResult(resultado, 'üéâ TESTE COMPLETO: SUCESSO!');
                } else {
                    throw new Error('Falha nas stats: ' + statsData.error);
                }
            })
            .catch(error => {
                console.error('‚ùå Erro no teste completo:', error);
                resultado.className = 'result error';
                appendResult(resultado, '‚ùå ERRO COMPLETO: ' + (error.message || ''));
            });
        }

        // Inicializa√ß√£o
        window.addEventListener('load', function() {
            console.log('üöÄ P√°gina teste simples carregada');
            logToDiv('P√°gina carregada com sucesso', 'log');
            
            // Teste autom√°tico b√°sico
            setTimeout(() => {
                console.log('üîÑ Executando teste autom√°tico...');
                testeBasico();
            }, 1000);
        });

        // Verificar se os bot√µes respondem
        document.addEventListener('click', function(event) {
            if (event.target.tagName === 'BUTTON') {
                console.log('üñ±Ô∏è Bot√£o clicado: ' + event.target.textContent);
            }
        });
    </script>
        <script src="/js/toast-fallback.js"></script>
        <script src="/js/event-fallback.js"></script>
    </body>
    </html>
